# ERD 설계

<img width="100%" alt="fintech-erd" src="https://user-images.githubusercontent.com/102597172/208899026-220c3e8a-24e4-409b-8c73-e39ee55b411b.png">


# 어플리케이션 구조

<img width="100%" src="https://user-images.githubusercontent.com/102597172/208916279-a55d0f8d-0959-4853-a0fc-12cc28f675f2.png">


# Swagger - API Document

![Untitled-6](https://user-images.githubusercontent.com/102597172/209642606-eb8da3b4-4bee-4031-9894-cff2b5e7fa0f.png)




# 상세 요구 사항

- [x]  계좌 검색 기능
- [x]  계좌 관리 (생성 / 삭제 / 금액 인출 / 금액 입금)
- [x]  송금 기능 및 송금 이력 조회
- [x]  계좌 잔액 조회 (기간별)
- [x]  로그인 / 로그아웃에 따른 계좌 접근 허가 기능 구현

**회원가입**

- User는 회원가입을 할 수 있다.
    - 회원가입 시 아이디, 비밀번호, 이름, 주민등록번호, 아이디가 필요하다.
    - 주민번호는 민감한 정보이기 때문에 암호화해서 저장한다.
    - 회원가입시 이미 회원가입된 아이디로 회원가입을 시도하면 에러를 발생한다.

**로그인**

- User는 가입 정보를 이용하여 로그인을 할수 있다.
    - 로그인시 회원가입한 적 없는 아이디를 이용하여 로그인을 시도하면 에러가 발생한다.
    - 로그인시 비밀번호가 일치하지 않는다면 에러가 발생한다.

**로그아웃**

- 기본적으로 n분 동안 로그인이 유지되며, 시간을 연장하면 n분으로 다시 초기화가 됨

`계좌 관리 (생성 / 삭제 / 금액 인출 / 금액 입금)`

**계좌 생성하기** 

- 계좌는 로그인 한 유저만 생성할 수 있다.
- 계좌 사용을 위한 계좌 비밀번호가 필요하다.

**계좌 삭제하기**

- 계좌는 로그인 한 유저만 삭제할 수 있다.
    - 삭제는 본인의 계좌만 삭제할 수 있다.
    - 삭제한 계좌에 유저는 접근할 수 없다.
- 계좌 삭제 전 본인인증이 필요하다.
- 삭제된 데이터는 일정 기간 보관한다.(약 n개월~n년)

**계좌 정보 수정하기**

- 계좌는 본인의 계좌만 수정할 수 있다.
- 계좌 비밀번호를 수정할 수 있다.
    - 수정 전 유저 본인 확인 필요하다.(회원 비밀번호 입력 필요)

**금액 인출하기**

- 인출 거래는 로그인 한 유저만 인출할 수 있다.
    - 본인의 계좌만 인출 가능하다.
- 계좌 거래 진행 전, 계좌 비밀번호가 필요하다. (비밀번호 입력 횟수 제한)
    - 비밀번호 입력 오류 발생 n회시 본인 인증 후 계좌 비밀번호 재설정

**금액 입금하기** 

- 로그인 한 유저만 입금할 수 있다.
- 입금 거래는 유저 본인의 저축 계좌에 입금 가능하다.
    - 입금 전, 거래 진행을 위한 계좌 비밀번호가 필요하다.  (비밀번호 입력 횟수 제한)
    - 입금 금액이 통장 잔액 보다 큰 금액을 입금하려는 경우 에러 발생

`송금기능 및 송금 이력 조회`

**다른 계좌로 송금하기**

- 송금 거래는 로그인한 유저만 거래할 수 있다.
    - 송금 거래 전, 송금하려는 상대 계좌 번호와 이름 확인이 필요하다.
    - 거래 진행을 위한 유저의 계좌 비밀번호가 필요하다. (비밀번호 입력 횟수 제한)
        - 계좌 유효한지 체크
        - 송금할 때 잔액보다 큰 금액을 입금하려는 경우 에러 발생
        - 상대방 계좌를 조회할 수 없을 때 에러 발생

**내 송금 이력 조회하기  (입/출금 내역으로 조회)**

- 송금 이력 조회는 로그인 한 유저만 확인할 수 있다.
    - 본인 계좌만 송금 이력을 조회할 수 있다.
    - 조회 전 계좌 비밀번호가 필요하다.(비밀번호 입력 횟수 제한)
- 기간 별로 이력 조회가 가능하다.
- 송금한 상대방 이름으로 조회가 가능하다
- 본인과 상대방의 이름과 계좌번호가 송금 이력에 남게 된다.

`계좌 잔액 조회 (기간별)`

- 기간 별 계좌 잔액 조회가 가능하다. (n일, n주, n개월, n년)
    - 계좌 잔액 조회 전, 해당 계좌 비밀번호가 필요하다. (비밀번호 입력 횟수 제한)

## [관리자]

`전체 사용자목록 확인`

- 관리자는 유저 전체 목록 확인이 가능하다.
    - 사용자 아이디, 이름, 계정 비밀번호를 확인할 수 있다.
- 관리자는 사용자의 정보를 삭제할 수 있다. (탈퇴 기능)

`전체 계좌목록 확인`

- 관리자는 유저의 계좌 목록 확인이 가능하다.
    - 사용자 아이디, 이름, 계좌 번호, 계좌 비밀번호를 확인할 수 있다.
    - 유저의 삭제 요청이 왔을 때 정지 처리를 할 수 있다.

`계좌 검색 기능`

- 유저의 계좌 검색이 가능하다.
    - 유저의 이름, 아이디, 계좌번호로 검색할 수 있다.

`관리자 추가, 목록, 삭제`

- 관리자 목록을 조회를 통해 관리자 추가와 삭제가 가능하다.
    - 관리자 아이디, 이름, 비밀번호 등의 정보 조회 가능




# 기능 구현

<table align="center">


<tr>


<th>서비스</th>

<th>관리</th>

</tr>


<td width="510">

- [x] 회원가입
- [x] 로그인
- [x] 계좌 생성/삭제
- [x] 계좌 입금/출금
- [x] 계좌 송금
- [x] 잔액 조회
- [x] 계좌 목록 조회
- [x] 거래 내역 조회
- [x] 사용자 정보 조회
- [x] 기간별 거래 조회

</td>

<td width="510">

- [x] 계정 상태 변경
- [x] 유저 상태 변경
- [x] 최근 가입 조회
- [x] 최근 거래 조회

</td>

</tr>

</table>

# 키워드

- JWT 토큰

보안에는 강하지만 서버의 메모리나 데이터베이스의 자원을 사용한다는 단점을 가진 세션을 보완하기 위해서 토큰 방식으로 구현을 했습니다.
여기서 말하는 토큰은 JWT 토큰 방식이며 Public Key는 웹 브라우저에 저장을 하지만 Secret Key가 저장되어 있는 곳에서만 복호화를 할 수 있다는 장점이 있기에 사용했습니다.

- Redis

조회가 잦은 데이터들은 Redis 캐시 서버에 저장을 하여 로딩을 최소화하였습니다. 아무래도 인 메모리 구조를 가지고 있기 때문에 하드디스크 같은 저장소에서 가져오는 것보다는 1000배 이상으로 빠른 속도를 기대할 수 있었고, 실무에서도 꾸준히 쓰이는 데이터베이스이기 때문에 적용을 시켰습니다. 다만, 메모리에 데이터가 저장되기 때문에 재부팅시에는 모든 데이터가 휘발된다는 단점이 있는데 이러한 단점은 Master Slave 방식으로 보완 가능합니다.

- 구글 SMTP 이메일 API

구글에서 제공하는 이메일 인증 API 기능을 사용하여 유저의 회원가입시 이메일 인증을 요구하도록 하고 있습니다. 인증이 완료되어야만 정상적으로 ACTIVE한 상태가 되고, 서비스를 이용할 수 있게 됩니다.

- Spring Security

해당 서비스는 USER와 ADMIN의 역할 총 2개로 나눠져있으며, ADMIN은 어떤 도메인이든 접근할 수 있지만, USER는 USER만 접근할 수 있는 도메인만 허용을 해야 하기 때문에 Spring Security를 구현    했습니다. 회원가입을 하면서 비밀번호나 주민등록번호를 입력하게 되는데 이때, 적용되는 패스워드 알고리즘도 Spring Security에서 제공하는 기능 중 하나입니다.
